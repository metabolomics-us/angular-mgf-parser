!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("ngx-logger")):"function"==typeof define&&define.amd?define("mgf-parser-lib",["exports","@angular/core","ngx-logger"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["mgf-parser-lib"]={},e.ng.core,e.i1)}(this,(function(e,t,r){"use strict";var n=function(e){var t=this;this.logger=e,this.handleName=function(e,r){var n=/(.+)_RI(.*)/.exec(e),i=/\s*([:\w\d\s-]+);/.exec(e);return n?(r.names.push(t.trim(n[1])),r.meta.push({name:"Retention Index",value:t.trim(n[2]),category:t.findCategory("Retention Index")})):i?r.names.push(t.trim(i[1])):r.name=t.trim(e),r},this.handleMetaDataField=function(e,r,n,i){i||(i="none");for(var o=n,a=o.exec(e);null!=a;){var s=t.trim(a[1]),c=t.trim(a[2]);0==t.ignoreField(s,c)&&r.meta.push({name:s,value:c,category:i}),a=o.exec(e)}return r},this.trim=function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"").replace(/^"(.*)"$/,"$1")},this.inspectFields=function(e,r){var n=/.*([A-Z]{14}-[A-Z]{10}-[A-Z,0-9])+.*/,i=/^([^J][0-9A-Za-z@+\-\[\]\(\)\\\/%=#$,.~&!]{6,})$/;if(n.exec(e[2]))r.inchiKey=n.exec(e[2])[1];else if("inchi"==e[1].toLowerCase()||"inchicode"==e[1].toLowerCase()||"inchi code"==e[1].toLowerCase())r.inchi=t.trim(e[2]);else if("smiles"==e[1].toLowerCase()&&i.exec(e[2]))r.smiles=i.exec(e[2])[1];else if("comment"===e[1].toLowerCase())r=t.handleMetaDataField(e[2],r,/(\w+)\s*=\s*([0-9]*\.?[0-9]+)/g,void 0);else if("searchid"===e[1].toLowerCase())r=t.handleMetaDataField(e[2],r,/(\w+\s?\w*)+:\s*([\w\d]+[ \w\d-]+)/g,"Database Identifier");else if("ms$focused_ion"===e[1].toLowerCase())r=t.handleMetaDataField(e[2],r,/\s*(.+):(.+)/g,"Derivatization");else{var o=e[1],a=e[2];0==t.ignoreField(o,a)&&r.meta.push({name:o,value:a,category:t.findCategory(o)})}return r},this.findCategory=function(e){var t="none";return""===(e=e.toLocaleLowerCase())||("retentionindex"===e||"retention index"===e||"retentiontime"===e||"retention time"===e?t="spectral properties":"instrument"!==e&&"instrumenttype"!==e&&"ionmode"!=e&&"precursormz"!=e||(t="acquisition properties")),t},this.ignoreField=function(e,r){return""==t.trim(e)||""==t.trim(r)||"retentiontime"==(e=e.toLowerCase())&&r<=0||"retentionindex"==e&&r<=0||("precursormz"===e||"derivative_mass"===e||"parent"===e)&&r<=0||"formula"==e||"synon"==e||"id"==e},this.convertWithCallback=function(e,r){t.logger.debug("starting with parsing new data set...");for(var n,i,o=/BEGIN IONS([\s\S]*?)END IONS/g,a=/\s*([^=\s]+)=(.*)\s/g,s=/^((?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)[ \t]((?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)[ \t]*(.+)?$/gm,c=/(\d*\.?\d{3,})/,d=e.toString("utf8");null!=(n=o.exec(d));){n=n[1];for(var l={meta:[],names:[],name:"",spectrum:"",accurate:!1};null!=(i=a.exec(n));)l="name"===i[1].toLowerCase()?t.handleName(i[2],l):t.inspectFields(i,l);l.accurate=!0;for(var u=[];null!=(i=s.exec(n));)i[1].toLowerCase().indexOf("e")>-1&&(i[1]=parseFloat(i[1]).toString()),i[2].toLowerCase().indexOf("e")>-1&&(i[2]=parseFloat(i[2]).toString()),u.push(i[1]+":"+i[2]),c.test(i[1])||(l.accurate=!1),i[3]&&l.meta.push({name:t.trim(i[3]),value:i[1],category:"annotation"});l.spectrum=u.join(" "),""!=l.spectrum?r(l):t.logger.warn("invalid spectrum found -> ignored")}},this.convertFromData=function(e,r){return t.convertWithCallback(e,r)},this.countSpectra=function(e){for(var t=0,r=e.indexOf("BEGIN IONS",0);-1!=r;)t++,r=e.indexOf("BEGIN IONS",r+1);return t}};n.ɵfac=function(e){return new(e||n)(t.ɵɵinject(r.NGXLogger))},n.ɵprov=t.ɵɵdefineInjectable({token:n,factory:n.ɵfac,providedIn:"root"});var i=function(){};i.ɵmod=t.ɵɵdefineNgModule({type:i}),i.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||i)},providers:[n],imports:[[r.LoggerModule.forRoot({level:r.NgxLoggerLevel.DEBUG,serverLogLevel:r.NgxLoggerLevel.OFF})]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(i,{imports:[r.LoggerModule]}),e.MgfParserLibModule=i,e.MgfParserLibService=n,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=mgf-parser-lib.umd.min.js.map